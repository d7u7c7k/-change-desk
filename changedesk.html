<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <title>ìë¦¬ ë°”ê¾¸ê¸° ë„êµ¬</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    :root {
      --bg: #f3f4f6;
      --bg-elevated: #ffffff;
      --primary: #2563eb;
      --primary-soft: #dbeafe;
      --border: #e5e7eb;
      --text-main: #111827;
      --text-sub: #6b7280;
      --radius-lg: 14px;
      --shadow-soft: 0 10px 25px rgba(15, 23, 42, 0.1);
    }

    * {
      box-sizing: border-box;
    }

    body {
      margin: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
        sans-serif;
      background: radial-gradient(circle at top, #e0f2fe 0, #f9fafb 50%);
      color: var(--text-main);
    }

    header {
      padding: 14px 16px;
      background: rgba(15, 23, 42, 0.9);
      color: #e5e7eb;
      border-bottom: 1px solid rgba(148, 163, 184, 0.4);
      position: sticky;
      top: 0;
      z-index: 10;
      backdrop-filter: blur(10px);
    }

    .header-inner {
      max-width: 1100px;
      margin: 0 auto;
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 10px;
      flex-wrap: wrap;
    }

    .header-title {
      font-size: 18px;
      font-weight: 700;
    }

    .header-sub {
      font-size: 11px;
      color: #9ca3af;
    }

    .page {
      max-width: 1100px;
      margin: 18px auto 28px;
      padding: 0 16px;
    }

    .layout {
      display: grid;
      grid-template-columns: minmax(260px, 330px) minmax(0, 1fr);
      gap: 16px;
    }

    @media (max-width: 800px) {
      .layout {
        grid-template-columns: 1fr;
      }
    }

    .panel {
      background: rgba(255, 255, 255, 0.96);
      border-radius: 18px;
      box-shadow: var(--shadow-soft);
      border: 1px solid rgba(209, 213, 219, 0.8);
      padding: 14px 14px 10px;
    }

    .panel-title {
      font-size: 15px;
      font-weight: 700;
      margin: 0 0 4px;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .panel-title span.icon {
      font-size: 18px;
    }

    .panel-desc {
      font-size: 11px;
      color: var(--text-sub);
      margin: 0 0 8px;
    }

    .field-group {
      margin-bottom: 10px;
    }

    .field-label {
      display: block;
      font-size: 12px;
      font-weight: 600;
      margin-bottom: 4px;
    }

    .field-row {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
    }

    input[type="number"],
    input[type="text"] {
      padding: 6px 8px;
      border-radius: 999px;
      border: 1px solid var(--border);
      font-size: 12px;
      min-width: 0;
    }

    input[type="number"] {
      width: 90px;
    }

    .btn {
      display: inline-flex;
      align-items: center;
      justify-content: center;
      gap: 4px;
      padding: 6px 10px;
      border-radius: 999px;
      border: none;
      font-size: 12px;
      font-weight: 500;
      cursor: pointer;
      white-space: nowrap;
    }

    .btn-primary {
      background: var(--primary);
      color: #ffffff;
    }

    .btn-ghost {
      background: #f9fafb;
      color: #374151;
      border: 1px solid #e5e7eb;
    }

    .btn-small {
      padding: 4px 8px;
      font-size: 11px;
    }

    .btn-block {
      width: 100%;
      justify-content: center;
    }

    .small-text {
      font-size: 11px;
      color: var(--text-sub);
    }

    .hr {
      border-top: 1px dashed #e5e7eb;
      margin: 8px 0;
    }

    /* ìë¦¬ ì˜ì—­ */
    .seat-panel-header {
      display: flex;
      align-items: baseline;
      justify-content: space-between;
      gap: 8px;
      margin-bottom: 8px;
    }

    .seat-title {
      font-size: 15px;
      font-weight: 700;
      display: flex;
      align-items: center;
      gap: 6px;
    }

    .seat-title span.icon {
      font-size: 18px;
    }

    .seat-caption {
      font-size: 11px;
      color: #6b7280;
    }

    .seat-toolbar {
      display: flex;
      flex-wrap: wrap;
      gap: 6px;
      align-items: center;
      margin-bottom: 8px;
    }

    .chip {
      font-size: 11px;
      padding: 4px 9px;
      border-radius: 999px;
      background: #e5e7eb;
      border: 1px solid #d1d5db;
      cursor: pointer;
    }

    .chip.active {
      background: #2563eb;
      color: white;
      border-color: #1d4ed8;
    }

    .seat-area {
      background: #e5e7eb;
      border-radius: 16px;
      padding: 10px;
      border: 1px solid #cbd5e1;
    }

    .board-label {
      text-align: center;
      font-size: 11px;
      font-weight: 600;
      color: #0f172a;
      margin: 4px 0 6px;
    }

    .board-top {
      display: block;
    }

    .board-bottom {
      display: none;
    }

    /* ì„ ìƒë‹˜ ì‹œì ì¼ ë•Œ ì¹ íŒì„ ì•„ë˜ë¡œ */
    .seat-area.teacher-view .board-top {
      display: none;
    }
    .seat-area.teacher-view .board-bottom {
      display: block;
    }

    .seat-container-wrapper {
      border-radius: 12px;
      background-image: linear-gradient(#e5e7eb 1px, transparent 1px),
        linear-gradient(90deg, #e5e7eb 1px, transparent 1px);
      background-size: 40px 40px;
      background-color: #f8fafc;
      padding: 8px;
      overflow: auto;
      max-height: 480px;
    }

    /* ê°€ë¡œ 6ì¹¸ ê³ ì • */
    .seat-container {
      display: grid;
      grid-template-columns: repeat(6, minmax(80px, 1fr));
      gap: 8px;
      min-height: 120px;
      transition: transform 0.2s ease;
    }

    .seat-slot {
      min-height: 54px;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    .seat-slot.empty {
      opacity: 0.35;
    }

    .seat {
      background: white;
      border-radius: 10px;
      border: 1px solid #cbd5e1;
      box-shadow: 0 1px 3px rgba(15, 23, 42, 0.12);
      cursor: grab;
      padding: 4px 6px;
      user-select: none;
      width: 100%;
    }

    .seat.dragging {
      opacity: 0.4;
    }

    .seat-inner {
      transform-origin: center;
    }

    .seat-line-main {
      font-size: 13px;
      font-weight: 700;
      text-align: center;
      margin-top: 2px;
    }

    .seat-line-sub {
      font-size: 10px;
      color: #6b7280;
      text-align: center;
      margin-top: 1px;
    }

    .no-seat {
      font-size: 12px;
      color: #9ca3af;
      text-align: center;
      padding: 30px 0;
    }

    /* ì¸ì‡„ ìŠ¤íƒ€ì¼ */
    @media print {
      body {
        background: #ffffff;
      }

      /* ë„êµ¬ ì´ë¦„/í—¤ë”, ì™¼ìª½ ì„¤ì • íŒ¨ë„, íˆ´ë°”/ì„¤ëª… ìˆ¨ê¸°ê¸° */
      header,
      .panel-settings,
      .seat-toolbar,
      .seat-caption {
        display: none !important;
      }

      /* ë ˆì´ì•„ì›ƒì„ 1ì—´ë¡œ â†’ ì¢Œì„í‘œê°€ ì „ì²´ í­ ì‚¬ìš© */
      .page {
        margin: 0;
        padding: 5mm;
        max-width: none;
      }

      .layout {
        display: block;
      }

      .panel-seat {
        box-shadow: none;
        border: none;
        padding: 0;
        width: 100%;
      }

      /* ì¢Œì„ ì˜ì—­ì„ ê°€ìš´ë°ë¡œ, ê°€ë¡œ A4ì— ë§ê²Œ ìµœëŒ€í­ í™•ëŒ€ */
      .seat-area {
        border: none;
        padding: 0;
        max-width: 260mm; /* A4 ê°€ë¡œ(297mm)ì—ì„œ ì¢Œìš° ì—¬ë°± ì¡°ê¸ˆ */
        margin: 0 auto;
      }

      .seat-container-wrapper {
        max-height: none;
        overflow: visible;
        background-size: 30px 30px;
        width: 100%;
      }

      .seat-container {
        width: 100%;
      }

      .seat {
        box-shadow: none;
      }

      .board-label {
        margin: 6px 0 10px;
        font-size: 12px;
        text-align: center;
      }
    }
  </style>
</head>
<body>
  <header>
    <div class="header-inner">
      <div>
        <div class="header-title">ìë¦¬ ë°”ê¾¸ê¸° ë„êµ¬</div>
        <div class="header-sub">
          ë²ˆí˜¸ ì„¤ì • â†’ ìë¦¬ ìƒì„± â†’ ëœë¤ ë°°ì¹˜ â†’ ì‹œì  ë°˜ì „ â†’ ì¸ì‡„. (1ì¸ 1ì±…ìƒ Â· ê°€ë¡œ 6ì¹¸ Â· ë¹ˆì¹¸ í—ˆìš©)
        </div>
      </div>
      <div class="small-text">
        íŒŒì¼ í•˜ë‚˜ë¡œ ì‹¤í–‰ Â· ë¸Œë¼ìš°ì €ì—ì„œ ë°”ë¡œ ì‚¬ìš© ê°€ëŠ¥
      </div>
    </div>
  </header>

  <main class="page">
    <div class="layout">
      <!-- ì™¼ìª½: ì„¤ì •/ëœë¤/ë·° -->
      <section class="panel panel-settings">
        <h2 class="panel-title">
          <span class="icon">ğŸ§©</span> ë²ˆí˜¸ ì„¤ì •
        </h2>
        <p class="panel-desc">
          ë°˜ í•™ìƒ ë²ˆí˜¸ ë²”ìœ„ë¥¼ ì„¤ì •í•œ ë’¤, â€œìë¦¬ ìƒì„±â€ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”. <br />
          1ì¸ 1ì±…ìƒ, ê°€ë¡œ 6ì¹¸ìœ¼ë¡œ ìë™ ë°°ì¹˜ë˜ë©°, ë¹ˆ ì¹¸ë„ í•¨ê»˜ ìƒì„±ë©ë‹ˆë‹¤.
        </p>

        <div class="field-group">
          <span class="field-label">ë²ˆí˜¸ ë²”ìœ„</span>
          <div class="field-row">
            <label class="small-text">ì‹œì‘</label>
            <input type="number" id="startNumber" value="1" min="1" />
            <label class="small-text">ë</label>
            <input type="number" id="endNumber" value="30" min="1" />
          </div>
          <div class="small-text">
            ì˜ˆ) 1ë²ˆë¶€í„° 29ë²ˆê¹Œì§€ ìˆìœ¼ë©´ ì‹œì‘=1, ë=29
          </div>
        </div>

        <div class="field-group">
          <button class="btn btn-primary btn-block" id="btnGenerateSeats">
            ìë¦¬ ìƒì„±
          </button>
        </div>

        <div class="hr"></div>

        <h2 class="panel-title">
          <span class="icon">ğŸ²</span> ëœë¤ ë°°ì¹˜
        </h2>
        <p class="panel-desc">
          í˜„ì¬ ì¢Œì„(ì±…ìƒ ìœ„ì¹˜)ì€ ê·¸ëŒ€ë¡œ ë‘” ì±„, ì•‰ì•„ ìˆëŠ” í•™ìƒ ë²ˆí˜¸ë§Œ ëœë¤ìœ¼ë¡œ ì„ìŠµë‹ˆë‹¤.
        </p>

        <div class="field-group">
          <span class="field-label">ìë¦¬ ìë™ ì„ê¸°</span>
          <button class="btn btn-primary btn-block" id="btnShuffleSeats">
            ì „ì²´ ìë¦¬ ëœë¤ ë°°ì¹˜
          </button>
          <div class="small-text">
            ë¹ˆ ì¹¸ì€ ê·¸ëŒ€ë¡œ ë‘ê³ , ì•‰ì•„ ìˆëŠ” í•™ìƒë“¤ë§Œ ì„œë¡œ ìë¦¬ë¥¼ ë°”ê¿‰ë‹ˆë‹¤.
          </div>
        </div>

        <div class="hr"></div>

        <h2 class="panel-title">
          <span class="icon">ğŸ‘€</span> ì‹œì  & ì¸ì‡„
        </h2>

        <div class="field-group">
          <span class="field-label">ë³´ê¸° ì‹œì </span>
          <div class="field-row">
            <button
              class="btn btn-ghost btn-small"
              id="btnViewStudent"
            >
              í•™ìƒ ì‹œì 
            </button>
            <button
              class="btn btn-ghost btn-small"
              id="btnViewTeacher"
            >
              ì„ ìƒë‹˜ ì‹œì  (ë°˜ì „ Â· ì¹ íŒ ì•„ë˜)
            </button>
          </div>
          <div class="small-text">
            ì„ ìƒë‹˜ ì‹œì ì€ ì¹ íŒì—ì„œ êµì‹¤ì„ ë°”ë¼ë³¸ ë°©í–¥ ê¸°ì¤€ì…ë‹ˆë‹¤. (ì¢Œìš°+ìœ„ì•„ë˜ ë°˜ì „)
          </div>
        </div>

        <div class="field-group">
          <span class="field-label">ì¸ì‡„</span>
          <button class="btn btn-primary btn-block" id="btnPrint">
            ì„ ìƒë‹˜ ì‹œì ìœ¼ë¡œ ì¸ì‡„
          </button>
          <div class="small-text">
            ì¸ì‡„ ì‹œì—ëŠ” ì¢Œì„í‘œë§Œ í¬ê²Œ ì¶œë ¥ë©ë‹ˆë‹¤.<br />
            (ë¸Œë¼ìš°ì € ì¸ì‡„ ì„¤ì •ì—ì„œ ë‚ ì§œ/í—¤ë”ëŠ” ëŒ ìˆ˜ ìˆìŠµë‹ˆë‹¤)
          </div>
        </div>
      </section>

      <!-- ì˜¤ë¥¸ìª½: ì¢Œì„ ì˜ì—­ -->
      <section class="panel panel-seat">
        <div class="seat-panel-header">
          <div class="seat-title">
            <span class="icon">ğŸª‘</span> ì¢Œì„ ë°°ì¹˜
          </div>
          <div class="seat-caption">
            ì±…ìƒì„ ë“œë˜ê·¸í•´ì„œ ìë¦¬ ìœ„ì¹˜ë¥¼ ë°”ê¿€ ìˆ˜ ìˆìŠµë‹ˆë‹¤. (ë¹ˆ ì¹¸ìœ¼ë¡œë„ ì´ë™ ê°€ëŠ¥)
          </div>
        </div>

        <div class="seat-toolbar">
          <span class="small-text" id="seatInfoText">
            ì•„ì§ ìë¦¬ê°€ ìƒì„±ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤. ì™¼ìª½ì—ì„œ ë²ˆí˜¸ ì„¤ì • í›„ â€œìë¦¬ ìƒì„±â€ì„ ëˆŒëŸ¬ ì£¼ì„¸ìš”.
          </span>
        </div>

        <div class="seat-area" id="seatArea">
          <div class="board-label board-top">[ ì¹ íŒ ]</div>
          <div class="seat-container-wrapper">
            <div class="seat-container" id="seatContainer">
              <div class="no-seat">
                ìë¦¬ ìƒì„± í›„ ì´ê³³ì— ì¢Œì„ì´ í‘œì‹œë©ë‹ˆë‹¤.
              </div>
            </div>
          </div>
          <div class="board-label board-bottom">[ ì¹ íŒ ]</div>
        </div>
      </section>
    </div>
  </main>

  <script>
    // ìƒíƒœ: slots = ê° ì¹¸ì— ì•‰ì€ "í•™ìƒ ë²ˆí˜¸" ë˜ëŠ” null (ë¹ˆì¹¸)
    let slots = []; // number | null
    let viewMode = "student"; // 'student' | 'teacher'
    let dragFromIndex = null;

    const startInput = document.getElementById("startNumber");
    const endInput = document.getElementById("endNumber");
    const generateBtn = document.getElementById("btnGenerateSeats");
    const shuffleBtn = document.getElementById("btnShuffleSeats");

    const seatContainer = document.getElementById("seatContainer");
    const seatInfoText = document.getElementById("seatInfoText");
    const seatArea = document.getElementById("seatArea");
    const btnViewStudent = document.getElementById("btnViewStudent");
    const btnViewTeacher = document.getElementById("btnViewTeacher");
    const btnPrint = document.getElementById("btnPrint");

    const COLS = 6;

    function clampNumber(value, min, fallback) {
      const n = Number(value);
      if (Number.isNaN(n) || n < min) return fallback;
      return n;
    }

    // ìë¦¬ ìƒì„± (1ì¸ 1ì±…ìƒ + ì—¬ìœ  ë¹ˆì¹¸)
    generateBtn.addEventListener("click", () => {
      const start = clampNumber(startInput.value, 1, 1);
      const end = clampNumber(endInput.value, start, start);
      if (end < start) {
        alert("ë ë²ˆí˜¸ëŠ” ì‹œì‘ ë²ˆí˜¸ë³´ë‹¤ í¬ê±°ë‚˜ ê°™ì•„ì•¼ í•©ë‹ˆë‹¤.");
        return;
      }
      const totalStudents = end - start + 1;

      // ê¸°ë³¸ ì¤„ ìˆ˜ + ì—¬ìœ  1ì¤„ (ë¹ˆì¹¸ì„ ìœ„í•œ ì¶”ê°€ ê³µê°„)
      const baseRows = Math.ceil(totalStudents / COLS);
      const rows = baseRows + 1; // ì—¬ìœ  1ì¤„
      const slotCount = rows * COLS;
      const emptyCount = slotCount - totalStudents;

      slots = new Array(slotCount).fill(null);

      // ì•ì—ì„œë¶€í„° í•™ìƒ ë²ˆí˜¸ ì±„ìš°ê¸°
      let idx = 0;
      for (let n = start; n <= end; n++) {
        slots[idx++] = n;
      }

      seatInfoText.textContent =
        `í•™ìƒ ${start}ë²ˆ ~ ${end}ë²ˆ (ì´ ${totalStudents}ëª…), ` +
        `ê°€ë¡œ ${COLS}ì¹¸ Â· ì„¸ë¡œ ${rows}ì¤„ (ë¹ˆ ì¹¸ ${emptyCount}ê°œ)`;
      renderSeats();
    });

    // ë°°ì—´ ì„ê¸°
    function shuffleArray(arr) {
      const a = arr.slice();
      for (let i = a.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [a[i], a[j]] = [a[j], a[i]];
      }
      return a;
    }

    // ì „ì²´ ìë¦¬ ëœë¤ ë°°ì¹˜ (ë¹ˆì¹¸ ìœ ì§€, í•™ìƒë§Œ ì„ê¸°)
    shuffleBtn.addEventListener("click", () => {
      if (!slots.length) {
        alert("ë¨¼ì € ìë¦¬ ìƒì„±ì„ í•´ ì£¼ì„¸ìš”.");
        return;
      }
      const occupiedIndexes = [];
      const students = [];
      slots.forEach((value, idx) => {
        if (value !== null) {
          occupiedIndexes.push(idx);
          students.push(value);
        }
      });
      if (!students.length) return;

      const shuffledStudents = shuffleArray(students);
      occupiedIndexes.forEach((slotIndex, i) => {
        slots[slotIndex] = shuffledStudents[i];
      });

      renderSeats();
    });

    // í•™ìƒ/ì„ ìƒë‹˜ ì‹œì ì— ë”°ë¼ í™”ë©´ì—ì„œ ë³´ì—¬ì£¼ëŠ” ìˆœì„œë¥¼ ë§¤í•‘
    function getIndexForDisplayPosition(pos) {
      const total = slots.length;
      if (!total) return pos;
      const rows = total / COLS;

      if (viewMode === "student") {
        return pos; // ê·¸ëŒ€ë¡œ
      } else {
        // 180ë„ íšŒì „: ìœ„ì•„ë˜ + ì¢Œìš° ë°˜ì „
        const row = Math.floor(pos / COLS);
        const col = pos % COLS;
        const revRow = rows - 1 - row;
        const revCol = COLS - 1 - col;
        return revRow * COLS + revCol;
      }
    }

    // ì¢Œì„ ë Œë”ë§
    function renderSeats() {
      seatContainer.innerHTML = "";
      seatArea.classList.toggle("teacher-view", viewMode === "teacher");

      if (!slots.length) {
        const div = document.createElement("div");
        div.className = "no-seat";
        div.textContent = "ìë¦¬ ìƒì„± í›„ ì´ê³³ì— ì¢Œì„ì´ í‘œì‹œë©ë‹ˆë‹¤.";
        seatContainer.appendChild(div);
        return;
      }

      const total = slots.length;

      for (let pos = 0; pos < total; pos++) {
        const realIndex = getIndexForDisplayPosition(pos);
        const studentNumber = slots[realIndex];

        const slotDiv = document.createElement("div");
        slotDiv.className = "seat-slot";
        slotDiv.dataset.slotIndex = realIndex;

        if (studentNumber === null) {
          slotDiv.classList.add("empty");
        } else {
          const seatDiv = document.createElement("div");
          seatDiv.className = "seat";
          seatDiv.draggable = true;

          const inner = document.createElement("div");
          inner.className = "seat-inner";

          const mainLine = document.createElement("div");
          mainLine.className = "seat-line-main";
          mainLine.textContent = `${studentNumber}ë²ˆ`;

          const subLine = document.createElement("div");
          subLine.className = "seat-line-sub";
          subLine.textContent = "";

          inner.appendChild(mainLine);
          inner.appendChild(subLine);
          seatDiv.appendChild(inner);
          slotDiv.appendChild(seatDiv);

          // ë“œë˜ê·¸ ì‹œì‘
          seatDiv.addEventListener("dragstart", (e) => {
            dragFromIndex = realIndex;
            seatDiv.classList.add("dragging");
            e.dataTransfer.effectAllowed = "move";
          });

          seatDiv.addEventListener("dragend", () => {
            dragFromIndex = null;
            seatDiv.classList.remove("dragging");
          });
        }

        // ë“œë¡­ ì¡´ (ë¹ˆ ì¹¸ í¬í•¨)
        slotDiv.addEventListener("dragover", (e) => {
          e.preventDefault();
          e.dataTransfer.dropEffect = "move";
        });

        slotDiv.addEventListener("drop", (e) => {
          e.preventDefault();
          const targetIndex = Number(slotDiv.dataset.slotIndex);
          if (dragFromIndex === null || dragFromIndex === targetIndex) return;

          const fromValue = slots[dragFromIndex];
          const toValue = slots[targetIndex];

          // swap (ë¹ˆì¹¸ í¬í•¨)
          slots[targetIndex] = fromValue;
          slots[dragFromIndex] = toValue ?? null;

          renderSeats();
        });

        seatContainer.appendChild(slotDiv);
      }
    }

    // ì‹œì  ë³€ê²½
    function updateViewButtons() {
      if (viewMode === "student") {
        btnViewStudent.classList.add("chip", "active");
        btnViewTeacher.classList.remove("chip", "active");
      } else {
        btnViewTeacher.classList.add("chip", "active");
        btnViewStudent.classList.remove("chip", "active");
      }
    }

    btnViewStudent.addEventListener("click", () => {
      viewMode = "student";
      updateViewButtons();
      renderSeats();
    });

    btnViewTeacher.addEventListener("click", () => {
      viewMode = "teacher";
      updateViewButtons();
      renderSeats();
    });

    // ì¸ì‡„ (í•­ìƒ ì„ ìƒë‹˜ ì‹œì ìœ¼ë¡œ)
    btnPrint.addEventListener("click", () => {
      viewMode = "teacher";
      updateViewButtons();
      renderSeats();
      window.print();
    });

    // ì´ˆê¸° ìƒíƒœ
    updateViewButtons();
    renderSeats();
  </script>
</body>
</html>
